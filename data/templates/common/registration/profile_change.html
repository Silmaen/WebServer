{% extends 'registration/base_registration.html' %}

{% block mainsection %}
<div class="reg-card">
    <div class="reg-card-title">
        <h4 class="mdi mdi-account-edit-outline"> Modifier le profil</h4>
    </div>
    <div class="reg-card-body">
        {% if form.errors or profile_form.errors %}
        <div class="form-errors">
            {% for field in form %}
                {% for error in field.errors %}
                    <div class="alert alert-danger">{{ error|escape }}</div>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <div class="alert alert-danger">{{ error|escape }}</div>
            {% endfor %}
            {% for field in profile_form %}
                {% for error in field.errors %}
                    <div class="alert alert-danger">{{ error|escape }}</div>
                {% endfor %}
            {% endfor %}
            {% for error in profile_form.non_field_errors %}
                <div class="alert alert-danger">{{ error|escape }}</div>
            {% endfor %}
        </div>
        {% endif %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-section">
                <h5 class="form-section-title mdi mdi-account"> Informations personnelles</h5>
                <div class="form-group">
                    <label for="{{ form.first_name.id_for_label }}">Pr&eacute;nom</label>
                    {{ form.first_name }}
                </div>
                <div class="form-group">
                    <label for="{{ form.last_name.id_for_label }}">Nom de famille</label>
                    {{ form.last_name }}
                </div>
                <div class="form-group">
                    <label for="{{ form.email.id_for_label }}">Courriel</label>
                    {{ form.email }}
                </div>
            </div>
            <div class="form-section">
                <h5 class="form-section-title mdi mdi-card-account-details-outline"> Profil</h5>
                <div class="form-group">
                    <label for="{{ profile_form.birthDate.id_for_label }}">Date de naissance</label>
                    {{ profile_form.birthDate }}
                </div>
                <div class="form-group">
                    <label>Avatar</label>
                    {% if user.userprofile.avatar %}
                    <div class="avatar-preview">
                        <img src="{{ user.userprofile.avatar.url }}" alt="Avatar actuel">
                    </div>
                    {% endif %}
                    {{ profile_form.avatar }}
                    <label for="{{ profile_form.avatar.id_for_label }}" class="file-input-label mdi mdi-upload"> Choisir une image</label>
                    <div class="file-input-name" id="avatar-filename">Aucun fichier choisi</div>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="comment-btn mdi mdi-content-save-outline"> Sauvegarder</button>
                <a class="comment-btn mdi mdi-account-key-outline" href="{% url 'password' %}"> Changer le mot de passe</a>
            </div>
        </form>
    </div>
    <div class="reg-card-footer">
        <a class="userbtn mdi mdi-arrow-left-circle-outline" href="{% url 'profile' %}"> Retour</a>
    </div>
</div>
<script>
document.getElementById('{{ profile_form.avatar.id_for_label }}').addEventListener('change', function() {
    var name = this.files.length ? this.files[0].name : 'Aucun fichier choisi';
    document.getElementById('avatar-filename').textContent = name;
});
</script>
{% endblock %}
